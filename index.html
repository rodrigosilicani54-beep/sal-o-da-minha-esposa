<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SalÃ£o da minha gatinha - Sistema de GestÃ£o</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .service-card {
            background: linear-gradient(135deg, #ffeef8 0%, #f8e8ff 100%);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
        }
        .shadow-custom {
            box-shadow: 0 8px 32px rgba(255, 107, 157, 0.2);
        }
        .btn-primary {
            background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.4);
        }
        .calendar-day {
            transition: all 0.2s ease;
        }
        .calendar-day:hover {
            background-color: #ffeef8;
        }
        .calendar-day.selected {
            background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
            color: white;
        }
        .time-slot {
            transition: all 0.2s ease;
        }
        .time-slot:hover {
            background-color: #ffeef8;
        }
        .time-slot.selected {
            background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
            color: white;
        }
        .floating-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white p-4 shadow-lg">
        <div class="flex items-center justify-between">
            <div>
                <h1 id="headerTitle" class="text-2xl font-bold">ğŸ’… SalÃ£o da minha gatinha</h1>
                <p class="text-pink-100 text-sm">Sistema de GestÃ£o</p>
            </div>
            <div class="text-right">
                <div class="text-sm opacity-90" id="currentDate"></div>
                <div class="flex gap-2 mt-2">
                    <button onclick="exportData()" class="text-xs bg-white bg-opacity-20 hover:bg-opacity-30 px-2 py-1 rounded transition-colors" title="Fazer backup dos dados">
                        ğŸ’¾ Backup
                    </button>
                    <button onclick="showStorageInfo()" class="text-xs bg-white bg-opacity-20 hover:bg-opacity-30 px-2 py-1 rounded transition-colors" title="Ver informaÃ§Ãµes de armazenamento">
                        ğŸ“± Info
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="flex overflow-x-auto">
            <button onclick="showSection('catalog')" class="nav-btn flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-600 hover:text-pink-600 border-b-2 border-transparent hover:border-pink-600 transition-colors">
                ğŸ“‹ CatÃ¡logo
            </button>
            <button onclick="showSection('pricing')" class="nav-btn flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-600 hover:text-pink-600 border-b-2 border-transparent hover:border-pink-600 transition-colors">
                ğŸ’° PreÃ§os
            </button>
            <button onclick="showSection('schedule')" class="nav-btn flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-600 hover:text-pink-600 border-b-2 border-transparent hover:border-pink-600 transition-colors">
                ğŸ“… Agenda
            </button>
            <button onclick="showSection('appointments')" class="nav-btn flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-600 hover:text-pink-600 border-b-2 border-transparent hover:border-pink-600 transition-colors">
                ğŸ“ Agendamentos
            </button>
            <button onclick="showSection('settings')" class="nav-btn flex-shrink-0 px-6 py-3 text-sm font-medium text-gray-600 hover:text-pink-600 border-b-2 border-transparent hover:border-pink-600 transition-colors">
                âš™ï¸ ConfiguraÃ§Ãµes
            </button>
        </div>
    </nav>

    <!-- Catalog Section -->
    <section id="catalog" class="section p-4">
        <div class="mb-6 flex justify-between items-center">
            <div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">CatÃ¡logo de ServiÃ§os</h2>
                <p class="text-gray-600">Nossos serviÃ§os de beleza</p>
            </div>
            <button onclick="toggleEditMode()" id="editCatalogBtn" class="btn-primary text-white py-2 px-4 rounded-lg font-medium">
                âœï¸ Editar
            </button>
        </div>

        <div id="catalogContent" class="space-y-4">
            <!-- Catalog will be generated dynamically -->
        </div>

        <!-- Add Service Form (Hidden by default) -->
        <div id="addServiceForm" class="hidden mt-6 bg-white rounded-xl p-4 shadow-custom">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Adicionar Novo ServiÃ§o</h3>
            <div class="space-y-3">
                <select id="newServiceCategory" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500">
                    <option value="Unhas">ğŸ’… Unhas</option>
                    <option value="Cabelos">ğŸ’‡â€â™€ï¸ Cabelos</option>
                    <option value="Outros">âœ¨ Outros ServiÃ§os</option>
                </select>
                <input type="text" id="newServiceName" placeholder="Nome do serviÃ§o" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500">
                <input type="text" id="newServiceDescription" placeholder="DescriÃ§Ã£o do serviÃ§o" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500">
                <input type="number" id="newServicePrice" placeholder="PreÃ§o (R$)" step="0.01" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500">
                <div class="flex gap-2">
                    <button onclick="addNewService()" class="flex-1 btn-primary text-white py-2 px-4 rounded-lg font-medium">
                        âœ… Adicionar
                    </button>
                    <button onclick="cancelAddService()" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-medium">
                        âŒ Cancelar
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Pricing Section -->
    <section id="pricing" class="section hidden p-4">
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Gerenciar PreÃ§os</h2>
            <p class="text-gray-600">Atualize os valores dos serviÃ§os</p>
        </div>

        <div class="space-y-4" id="pricingList">
            <!-- Pricing items will be generated here -->
        </div>

        <button onclick="savePrices()" class="w-full btn-primary text-white py-3 px-6 rounded-xl font-semibold mt-6">
            ğŸ’¾ Salvar PreÃ§os
        </button>
    </section>

    <!-- Schedule Section -->
    <section id="schedule" class="section hidden p-4">
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Agendar HorÃ¡rio</h2>
            <p class="text-gray-600">Marque um novo atendimento</p>
        </div>

        <!-- Client Info -->
        <div class="bg-white rounded-xl p-4 shadow-custom mb-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Dados do Cliente</h3>
            <div class="space-y-3">
                <input type="text" id="clientName" placeholder="Nome do cliente" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                <input type="tel" id="clientPhone" placeholder="Telefone (WhatsApp)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
            </div>
        </div>

        <!-- Service Selection -->
        <div class="bg-white rounded-xl p-4 shadow-custom mb-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Escolher ServiÃ§o</h3>
            <select id="serviceSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                <option value="">Selecione um serviÃ§o</option>
            </select>
            <div id="servicePrice" class="mt-2 text-lg font-semibold text-pink-600"></div>
        </div>

        <!-- Calendar -->
        <div class="bg-white rounded-xl p-4 shadow-custom mb-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Escolher Data</h3>
            <div id="calendar" class="grid grid-cols-7 gap-1 text-center">
                <!-- Calendar will be generated here -->
            </div>
        </div>

        <!-- Time Slots -->
        <div class="bg-white rounded-xl p-4 shadow-custom mb-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Escolher HorÃ¡rio</h3>
            <div id="timeSlots" class="grid grid-cols-3 gap-2">
                <!-- Time slots will be generated here -->
            </div>
        </div>

        <!-- Payment Status -->
        <div class="bg-white rounded-xl p-4 shadow-custom mb-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Status do Pagamento</h3>
            <div class="flex gap-4">
                <label class="flex items-center">
                    <input type="radio" name="paymentStatus" value="pago" class="mr-2 text-pink-600">
                    <span class="text-green-600 font-semibold">âœ… Pago</span>
                </label>
                <label class="flex items-center">
                    <input type="radio" name="paymentStatus" value="pendente" checked class="mr-2 text-pink-600">
                    <span class="text-orange-600 font-semibold">â³ Pendente</span>
                </label>
            </div>
        </div>

        <button onclick="scheduleAppointment()" class="w-full btn-primary text-white py-3 px-6 rounded-xl font-semibold">
            ğŸ“… Agendar e Enviar WhatsApp
        </button>
    </section>

    <!-- Appointments Section -->
    <section id="appointments" class="section hidden p-4">
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Agendamentos</h2>
            <p class="text-gray-600">Visualize todos os agendamentos</p>
        </div>

        <div id="appointmentsList" class="space-y-4">
            <!-- Appointments will be listed here -->
        </div>
    </section>

    <!-- Settings Section -->
    <section id="settings" class="section hidden p-4">
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-2">ConfiguraÃ§Ãµes do SalÃ£o</h2>
            <p class="text-gray-600">Personalize as informaÃ§Ãµes do seu salÃ£o</p>
        </div>

        <div class="bg-white rounded-xl p-4 shadow-custom mb-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">InformaÃ§Ãµes BÃ¡sicas</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome do SalÃ£o</label>
                    <input type="text" id="salonName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">EndereÃ§o</label>
                    <input type="text" id="salonAddress" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Telefone (WhatsApp)</label>
                    <input type="tel" id="salonPhone" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">PolÃ­tica de Cancelamento</label>
                    <textarea id="salonCancellationPolicy" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"></textarea>
                </div>
            </div>
        </div>

        <div class="flex gap-3">
            <button onclick="saveSalonSettings()" class="flex-1 btn-primary text-white py-3 px-6 rounded-xl font-semibold">
                ğŸ’¾ Salvar ConfiguraÃ§Ãµes
            </button>
            <button onclick="resetSalonSettings()" class="bg-gray-500 hover:bg-gray-600 text-white py-3 px-6 rounded-xl font-semibold">
                ğŸ”„ Restaurar PadrÃ£o
            </button>
        </div>

        <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 mt-6">
            <div class="flex items-start">
                <div class="text-yellow-600 text-xl mr-3">ğŸ’¡</div>
                <div>
                    <h4 class="font-semibold text-yellow-800 mb-1">Dica Importante</h4>
                    <p class="text-sm text-yellow-700">Essas informaÃ§Ãµes aparecerÃ£o nos comprovantes de agendamento enviados pelo WhatsApp e nos compromissos do Google Agenda.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Floating WhatsApp Button -->
    <button onclick="openWhatsApp()" class="floating-btn btn-primary text-white p-4 rounded-full shadow-lg">
        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
        </svg>
    </button>

    <script>
        // Data storage
        let salonSettings = {
            name: 'SalÃ£o da minha gatinha',
            address: 'Rua das Graviolas, NÂ° 350',
            phone: '(11) 95246-8795',
            cancellationPolicy: 'Cancelamentos com menos de 2h nÃ£o terÃ£o reembolso'
        };
        
        let services = [
            { category: 'Unhas', name: 'EsmaltaÃ§Ã£o Simples', description: 'EsmaltaÃ§Ã£o tradicional com cores variadas', price: 25 },
            { category: 'Unhas', name: 'EsmaltaÃ§Ã£o em Gel', description: 'EsmaltaÃ§Ã£o duradoura com acabamento profissional', price: 40 },
            { category: 'Unhas', name: 'Nail Art', description: 'DecoraÃ§Ãµes artÃ­sticas personalizadas', price: 60 },
            { category: 'Unhas', name: 'Alongamento', description: 'Alongamento com gel ou fibra de vidro', price: 80 },
            { category: 'Cabelos', name: 'Corte Feminino', description: 'Cortes modernos e personalizados', price: 50 },
            { category: 'Cabelos', name: 'ColoraÃ§Ã£o', description: 'Tintura completa ou mechas', price: 120 },
            { category: 'Cabelos', name: 'HidrataÃ§Ã£o', description: 'Tratamento nutritivo para cabelos', price: 70 },
            { category: 'Cabelos', name: 'Escova Progressiva', description: 'Alisamento e reduÃ§Ã£o de volume', price: 200 },
            { category: 'Cabelos', name: 'Penteado', description: 'Penteados para eventos especiais', price: 80 },
            { category: 'Outros', name: 'Sobrancelha', description: 'Design e modelagem de sobrancelhas', price: 30 },
            { category: 'Outros', name: 'DepilaÃ§Ã£o', description: 'DepilaÃ§Ã£o com cera', price: 45 }
        ];

        let appointments = [];
        let selectedDate = null;
        let selectedTime = null;
        let isEditMode = false;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateCurrentDate();
            showSection('catalog');
            generateCatalog();
            generatePricingList();
            generateServiceSelect();
            generateCalendar();
            generateTimeSlots();
            loadSalonSettingsForm();
        });

        // Load data from localStorage with recovery options
        function loadData() {
            try {
                // Try to load main data
                const savedServices = localStorage.getItem('salonServices');
                const savedAppointments = localStorage.getItem('salonAppointments');
                const savedSettings = localStorage.getItem('salonSettings');
                
                if (savedServices) {
                    services = JSON.parse(savedServices);
                    console.log(`âœ… ${services.length} serviÃ§os carregados do dispositivo`);
                }
                
                if (savedAppointments) {
                    appointments = JSON.parse(savedAppointments);
                    console.log(`âœ… ${appointments.length} agendamentos carregados do dispositivo`);
                }
                
                if (savedSettings) {
                    salonSettings = JSON.parse(savedSettings);
                    console.log(`âœ… ConfiguraÃ§Ãµes do salÃ£o carregadas`);
                    updateHeaderTitle();
                }
                
                // Check for backup if main data is corrupted or missing
                if ((!savedServices || !savedAppointments) && localStorage.getItem('salonBackup')) {
                    console.log('ğŸ”„ Tentando recuperar dados do backup...');
                    const backup = JSON.parse(localStorage.getItem('salonBackup'));
                    
                    if (!savedServices && backup.services) {
                        services = backup.services;
                        console.log('âœ… ServiÃ§os recuperados do backup');
                    }
                    
                    if (!savedAppointments && backup.appointments) {
                        appointments = backup.appointments;
                        console.log('âœ… Agendamentos recuperados do backup');
                    }
                }
                
                // Show storage info
                showStorageInfo();
                
            } catch (error) {
                console.error('âŒ Erro ao carregar dados:', error);
                alert('âš ï¸ Erro ao carregar dados salvos. Usando dados padrÃ£o.');
            }
        }

        // Save data to localStorage with backup
        function saveData() {
            try {
                // Save main data
                localStorage.setItem('salonServices', JSON.stringify(services));
                localStorage.setItem('salonAppointments', JSON.stringify(appointments));
                localStorage.setItem('salonSettings', JSON.stringify(salonSettings));
                
                // Create backup with timestamp
                const backupData = {
                    services: services,
                    appointments: appointments,
                    salonSettings: salonSettings,
                    lastBackup: new Date().toISOString(),
                    version: '1.0'
                };
                localStorage.setItem('salonBackup', JSON.stringify(backupData));
                
                // Save individual appointment history for better tracking
                appointments.forEach(appointment => {
                    const key = `appointment_${appointment.id}`;
                    localStorage.setItem(key, JSON.stringify(appointment));
                });
                
                console.log('âœ… Dados salvos com sucesso no dispositivo');
            } catch (error) {
                console.error('âŒ Erro ao salvar dados:', error);
                alert('âš ï¸ Erro ao salvar dados. Verifique o espaÃ§o de armazenamento do dispositivo.');
            }
        }

        // Update current date
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('pt-BR', options);
        }

        // Show section
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-pink-600', 'border-pink-600');
                btn.classList.add('text-gray-600', 'border-transparent');
            });
            
            // Show selected section
            document.getElementById(sectionName).classList.remove('hidden');
            
            // Add active class to clicked nav button
            if (event && event.target) {
                event.target.classList.remove('text-gray-600', 'border-transparent');
                event.target.classList.add('text-pink-600', 'border-pink-600');
            }
            
            // Refresh data when showing specific sections
            if (sectionName === 'appointments') {
                displayAppointments();
            } else if (sectionName === 'schedule') {
                // Regenerate calendar, time slots and service select to ensure they work
                generateCalendar();
                generateTimeSlots();
                generateServiceSelect();
            } else if (sectionName === 'settings') {
                loadSalonSettingsForm();
            }
            
            // Reset edit mode when changing sections
            if (sectionName !== 'catalog') {
                isEditMode = false;
                const editBtn = document.getElementById('editCatalogBtn');
                if (editBtn) {
                    editBtn.textContent = 'âœï¸ Editar';
                    editBtn.classList.add('btn-primary');
                    editBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                }
                const addForm = document.getElementById('addServiceForm');
                if (addForm) {
                    addForm.classList.add('hidden');
                }
            }
        }

        // Generate catalog
        function generateCatalog() {
            const catalogContent = document.getElementById('catalogContent');
            const categories = [...new Set(services.map(s => s.category))];
            
            const categoryEmojis = {
                'Unhas': 'ğŸ’…',
                'Cabelos': 'ğŸ’‡â€â™€ï¸',
                'Outros': 'âœ¨'
            };
            
            catalogContent.innerHTML = categories.map(category => {
                const categoryServices = services.filter(s => s.category === category);
                
                return `
                    <div class="service-card rounded-xl p-4 shadow-custom">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center">
                                <div class="text-3xl mr-3">${categoryEmojis[category] || 'âœ¨'}</div>
                                <h3 class="text-xl font-bold text-gray-800">${category}</h3>
                            </div>
                            ${isEditMode ? `<button onclick="showAddServiceForm('${category}')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-lg text-sm font-medium">+ Adicionar</button>` : ''}
                        </div>
                        <div class="grid grid-cols-1 gap-3">
                            ${categoryServices.map(service => `
                                <div class="bg-white rounded-lg p-3 shadow-sm">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <h4 class="font-semibold text-gray-700">${service.name}</h4>
                                            <p class="text-sm text-gray-600">${service.description}</p>
                                            <p class="text-lg font-bold text-pink-600 mt-1">R$ ${service.price.toFixed(2)}</p>
                                        </div>
                                        ${isEditMode ? `
                                            <div class="flex gap-1 ml-2">
                                                <button onclick="editService('${service.category}', '${service.name}')" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs">âœï¸</button>
                                                <button onclick="deleteService('${service.category}', '${service.name}')" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">ğŸ—‘ï¸</button>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Toggle edit mode
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const editBtn = document.getElementById('editCatalogBtn');
            
            if (isEditMode) {
                editBtn.textContent = 'âœ… Finalizar';
                editBtn.classList.remove('btn-primary');
                editBtn.classList.add('bg-green-500', 'hover:bg-green-600');
            } else {
                editBtn.textContent = 'âœï¸ Editar';
                editBtn.classList.add('btn-primary');
                editBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                document.getElementById('addServiceForm').classList.add('hidden');
            }
            
            generateCatalog();
        }

        // Show add service form
        function showAddServiceForm(category = '') {
            const form = document.getElementById('addServiceForm');
            form.classList.remove('hidden');
            
            if (category) {
                document.getElementById('newServiceCategory').value = category;
            }
            
            // Clear form
            document.getElementById('newServiceName').value = '';
            document.getElementById('newServiceDescription').value = '';
            document.getElementById('newServicePrice').value = '';
        }

        // Add new service
        function addNewService() {
            const category = document.getElementById('newServiceCategory').value;
            const name = document.getElementById('newServiceName').value.trim();
            const description = document.getElementById('newServiceDescription').value.trim();
            const price = parseFloat(document.getElementById('newServicePrice').value) || 0;
            
            if (!name) {
                alert('âŒ Por favor, informe o nome do serviÃ§o');
                return;
            }
            
            if (!description) {
                alert('âŒ Por favor, informe a descriÃ§Ã£o do serviÃ§o');
                return;
            }
            
            if (price <= 0) {
                alert('âŒ Por favor, informe um preÃ§o vÃ¡lido');
                return;
            }
            
            // Check if service already exists
            const exists = services.some(s => s.category === category && s.name === name);
            if (exists) {
                alert('âŒ JÃ¡ existe um serviÃ§o com este nome nesta categoria');
                return;
            }
            
            // Add service
            services.push({ category, name, description, price });
            saveData();
            generateCatalog();
            generatePricingList();
            generateServiceSelect();
            
            // Hide form
            document.getElementById('addServiceForm').classList.add('hidden');
            
            alert('âœ… ServiÃ§o adicionado com sucesso!');
        }

        // Cancel add service
        function cancelAddService() {
            document.getElementById('addServiceForm').classList.add('hidden');
        }

        // Edit service
        function editService(category, name) {
            const service = services.find(s => s.category === category && s.name === name);
            if (!service) return;
            
            const newName = prompt('Nome do serviÃ§o:', service.name);
            if (newName === null) return;
            
            const newDescription = prompt('DescriÃ§Ã£o:', service.description);
            if (newDescription === null) return;
            
            const newPrice = prompt('PreÃ§o (R$):', service.price);
            if (newPrice === null) return;
            
            const price = parseFloat(newPrice);
            if (isNaN(price) || price <= 0) {
                alert('âŒ PreÃ§o invÃ¡lido');
                return;
            }
            
            // Update service
            service.name = newName.trim();
            service.description = newDescription.trim();
            service.price = price;
            
            saveData();
            generateCatalog();
            generatePricingList();
            generateServiceSelect();
            
            alert('âœ… ServiÃ§o atualizado com sucesso!');
        }

        // Delete service
        function deleteService(category, name) {
            if (!confirm('âŒ Tem certeza que deseja excluir este serviÃ§o?')) return;
            
            const index = services.findIndex(s => s.category === category && s.name === name);
            if (index !== -1) {
                services.splice(index, 1);
                saveData();
                generateCatalog();
                generatePricingList();
                generateServiceSelect();
                alert('âœ… ServiÃ§o excluÃ­do com sucesso!');
            }
        }

        // Generate pricing list
        function generatePricingList() {
            const pricingList = document.getElementById('pricingList');
            pricingList.innerHTML = '';
            
            const categories = [...new Set(services.map(s => s.category))];
            
            categories.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'service-card rounded-xl p-4 shadow-custom';
                
                const categoryServices = services.filter(s => s.category === category);
                
                categoryDiv.innerHTML = `
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">${category}</h3>
                    <div class="space-y-3">
                        ${categoryServices.map((service, index) => `
                            <div class="flex items-center justify-between bg-white rounded-lg p-3 shadow-sm">
                                <span class="font-medium text-gray-700">${service.name}</span>
                                <div class="flex items-center">
                                    <span class="text-gray-600 mr-2">R$</span>
                                    <input type="number" 
                                           value="${service.price}" 
                                           onchange="updateServicePrice('${service.category}', '${service.name}', this.value)"
                                           class="w-20 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-pink-500 focus:border-transparent text-center">
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                pricingList.appendChild(categoryDiv);
            });
        }

        // Update service price
        function updateServicePrice(category, name, newPrice) {
            const serviceIndex = services.findIndex(s => s.category === category && s.name === name);
            if (serviceIndex !== -1) {
                services[serviceIndex].price = parseFloat(newPrice) || 0;
                saveData(); // Auto-save when price changes
                generateServiceSelect(); // Update service select immediately
            }
        }

        // Save prices
        function savePrices() {
            saveData();
            generateServiceSelect(); // Update service select with new prices
            alert('âœ… PreÃ§os salvos com sucesso!');
        }

        // Generate service select
        function generateServiceSelect() {
            const serviceSelect = document.getElementById('serviceSelect');
            if (!serviceSelect) return;
            
            // Clear existing options and event listeners
            serviceSelect.innerHTML = '';
            serviceSelect.removeEventListener('change', handleServiceChange);
            
            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Selecione um serviÃ§o';
            serviceSelect.appendChild(defaultOption);
            
            const categories = [...new Set(services.map(s => s.category))];
            
            categories.forEach(category => {
                const optgroup = document.createElement('optgroup');
                optgroup.label = category;
                
                const categoryServices = services.filter(s => s.category === category);
                categoryServices.forEach(service => {
                    const option = document.createElement('option');
                    option.value = JSON.stringify(service);
                    option.textContent = `${service.name} - R$ ${service.price.toFixed(2)}`;
                    optgroup.appendChild(option);
                });
                
                serviceSelect.appendChild(optgroup);
            });
            
            // Add event listener
            serviceSelect.addEventListener('change', handleServiceChange);
        }

        // Handle service selection change
        function handleServiceChange() {
            const servicePriceDiv = document.getElementById('servicePrice');
            if (this.value) {
                try {
                    const service = JSON.parse(this.value);
                    servicePriceDiv.textContent = `Valor: R$ ${service.price.toFixed(2)}`;
                } catch (error) {
                    console.error('Erro ao processar serviÃ§o:', error);
                    servicePriceDiv.textContent = '';
                }
            } else {
                servicePriceDiv.textContent = '';
            }
        }

        // Generate calendar
        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = ''; // Clear existing calendar
            
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            // Days of week header
            const daysOfWeek = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'SÃ¡b'];
            daysOfWeek.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'p-2 text-xs font-semibold text-gray-600 bg-gray-100';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // Add empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'p-2';
                calendar.appendChild(emptyDay);
            }
            
            // Add days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                const dayDate = new Date(currentYear, currentMonth, day);
                const isToday = dayDate.toDateString() === today.toDateString();
                const isPast = dayDate < today && !isToday;
                
                dayElement.className = `calendar-day p-3 text-sm font-medium cursor-pointer rounded-lg border transition-all ${
                    isPast ? 'text-gray-400 cursor-not-allowed bg-gray-100' : 'text-gray-700 hover:bg-pink-50 border-gray-200 hover:border-pink-300'
                } ${isToday ? 'bg-pink-100 border-pink-300 font-bold' : ''}`;
                
                dayElement.textContent = day;
                dayElement.setAttribute('data-day', day);
                dayElement.setAttribute('data-month', currentMonth);
                dayElement.setAttribute('data-year', currentYear);
                
                if (!isPast) {
                    dayElement.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Remove previous selection
                        document.querySelectorAll('.calendar-day.selected').forEach(el => {
                            el.classList.remove('selected');
                        });
                        
                        // Add selection to clicked day
                        this.classList.add('selected');
                        
                        const selectedDay = parseInt(this.getAttribute('data-day'));
                        const selectedMonth = parseInt(this.getAttribute('data-month'));
                        const selectedYear = parseInt(this.getAttribute('data-year'));
                        
                        selectedDate = new Date(selectedYear, selectedMonth, selectedDay);
                        
                        console.log('Data selecionada:', selectedDate);
                    });
                }
                
                calendar.appendChild(dayElement);
            }
        }

        // Generate time slots
        function generateTimeSlots() {
            const timeSlots = document.getElementById('timeSlots');
            timeSlots.innerHTML = ''; // Clear existing slots
            
            const slots = [
                '09:00', '09:30', '10:00', '10:30', '11:00', '11:30',
                '14:00', '14:30', '15:00', '15:30', '16:00', '16:30',
                '17:00', '17:30', '18:00', '18:30'
            ];
            
            slots.forEach(time => {
                const timeElement = document.createElement('div');
                timeElement.className = 'time-slot p-3 text-center text-sm font-medium border border-gray-300 rounded-lg cursor-pointer hover:bg-pink-50 hover:border-pink-300 transition-all';
                timeElement.textContent = time;
                timeElement.setAttribute('data-time', time);
                
                timeElement.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove previous selection
                    document.querySelectorAll('.time-slot.selected').forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    // Add selection to clicked time
                    this.classList.add('selected');
                    selectedTime = this.getAttribute('data-time');
                    
                    console.log('HorÃ¡rio selecionado:', selectedTime);
                });
                
                timeSlots.appendChild(timeElement);
            });
        }

        // Schedule appointment
        function scheduleAppointment() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientPhone = document.getElementById('clientPhone').value.trim();
            const serviceSelect = document.getElementById('serviceSelect');
            const paymentStatusElement = document.querySelector('input[name="paymentStatus"]:checked');
            
            // Validation
            if (!clientName) {
                alert('âŒ Por favor, informe o nome do cliente');
                return;
            }
            
            if (!clientPhone) {
                alert('âŒ Por favor, informe o telefone do cliente');
                return;
            }
            
            if (!serviceSelect.value) {
                alert('âŒ Por favor, selecione um serviÃ§o');
                return;
            }
            
            if (!selectedDate) {
                alert('âŒ Por favor, selecione uma data');
                return;
            }
            
            if (!selectedTime) {
                alert('âŒ Por favor, selecione um horÃ¡rio');
                return;
            }
            
            const paymentStatus = paymentStatusElement ? paymentStatusElement.value : 'pendente';
            
            try {
                const service = JSON.parse(serviceSelect.value);
                
                // Check if time slot is already taken
                const dateStr = selectedDate.toDateString();
                const isTimeSlotTaken = appointments.some(apt => {
                    const aptDate = new Date(apt.date);
                    return aptDate.toDateString() === dateStr && apt.time === selectedTime;
                });
                
                if (isTimeSlotTaken) {
                    alert('âŒ Este horÃ¡rio jÃ¡ estÃ¡ ocupado. Por favor, escolha outro horÃ¡rio.');
                    return;
                }
                
                // Create appointment
                const appointment = {
                    id: Date.now(),
                    clientName,
                    clientPhone,
                    service: service.name,
                    category: service.category,
                    price: service.price,
                    date: selectedDate.toISOString(),
                    time: selectedTime,
                    paymentStatus,
                    createdAt: new Date().toISOString()
                };
                
                appointments.push(appointment);
                saveData();
                
                // Generate WhatsApp message
                generateWhatsAppMessage(appointment);
                
                // Add to Google Calendar
                addToGoogleCalendar(appointment);
                
                // Clear form
                clearScheduleForm();
                
                alert('âœ… Agendamento realizado com sucesso!\n\nğŸ“± Dados salvos no seu celular\nğŸ’¬ Mensagem do WhatsApp serÃ¡ aberta\nğŸ“… Compromisso criado no Google Agenda\nğŸ’¾ Backup automÃ¡tico criado');
                
            } catch (error) {
                console.error('Erro ao processar agendamento:', error);
                alert('âŒ Erro ao processar agendamento. Tente novamente.');
            }
        }

        // Clear schedule form
        function clearScheduleForm() {
            document.getElementById('clientName').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('serviceSelect').value = '';
            document.getElementById('servicePrice').textContent = '';
            document.querySelector('input[name="paymentStatus"][value="pendente"]').checked = true;
            
            // Clear selections
            document.querySelectorAll('.calendar-day.selected').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelectorAll('.time-slot.selected').forEach(el => {
                el.classList.remove('selected');
            });
            
            selectedDate = null;
            selectedTime = null;
        }

        // Add to Google Calendar
        function addToGoogleCalendar(appointment) {
            try {
                const appointmentDate = new Date(appointment.date);
                const [hours, minutes] = appointment.time.split(':');
                
                // Set start time
                const startTime = new Date(appointmentDate);
                startTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                
                // Set end time (1.5 hours later for most services)
                const endTime = new Date(startTime);
                endTime.setHours(startTime.getHours() + 1, startTime.getMinutes() + 30);
                
                // Format dates for Google Calendar (YYYYMMDDTHHMMSSZ)
                const formatGoogleDate = (date) => {
                    return date.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '');
                };
                
                const startFormatted = formatGoogleDate(startTime);
                const endFormatted = formatGoogleDate(endTime);
                
                // Create event details
                const eventTitle = `ğŸ’… ${appointment.service} - ${appointment.clientName}`;
                const eventDetails = `ğŸ“‹ AGENDAMENTO ${salonSettings.name.toUpperCase()}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‘¤ Cliente: ${appointment.clientName}
ğŸ“ Telefone: ${appointment.clientPhone}
ğŸ’„ ServiÃ§o: ${appointment.service}
ğŸ’° Valor: R$ ${appointment.price.toFixed(2)}
ğŸ’³ Pagamento: ${appointment.paymentStatus.toUpperCase()}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ Local: ${salonSettings.name}
${salonSettings.address}

âš ï¸ Lembrete:
â€¢ Chegue 10 minutos antes
â€¢ Ligue em caso de atraso: ${salonSettings.phone}
â€¢ ${salonSettings.cancellationPolicy}`;

                const eventLocation = `${salonSettings.name} - ${salonSettings.address}`;
                
                // Create Google Calendar URL
                const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(eventTitle)}&dates=${startFormatted}/${endFormatted}&details=${encodeURIComponent(eventDetails)}&location=${encodeURIComponent(eventLocation)}&sf=true&output=xml`;
                
                // Open Google Calendar in new tab
                window.open(googleCalendarUrl, '_blank');
                
                console.log('ğŸ“… Compromisso criado no Google Agenda:', {
                    cliente: appointment.clientName,
                    data: startTime.toLocaleString('pt-BR'),
                    servico: appointment.service
                });
                
            } catch (error) {
                console.error('âŒ Erro ao criar compromisso no Google Agenda:', error);
                alert('âš ï¸ NÃ£o foi possÃ­vel criar o compromisso no Google Agenda automaticamente.\nVocÃª pode adicionar manualmente:\n\n' + 
                      `ğŸ“… Data: ${new Date(appointment.date).toLocaleDateString('pt-BR')}\n` +
                      `â° HorÃ¡rio: ${appointment.time}\n` +
                      `ğŸ‘¤ Cliente: ${appointment.clientName}\n` +
                      `ğŸ’„ ServiÃ§o: ${appointment.service}`);
            }
        }

        // Generate WhatsApp message
        function generateWhatsAppMessage(appointment) {
            const date = new Date(appointment.date);
            const formattedDate = date.toLocaleDateString('pt-BR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const paymentEmoji = appointment.paymentStatus === 'pago' ? 'âœ…' : 'â³';
            const paymentText = appointment.paymentStatus === 'pago' ? 'PAGO' : 'PENDENTE';
            
            const message = `ğŸ’… *${salonSettings.name.toUpperCase()}*
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ *COMPROVANTE DE AGENDAMENTO*

ğŸ‘¤ *Cliente:* ${appointment.clientName}
ğŸ“… *Data:* ${formattedDate}
â° *HorÃ¡rio:* ${appointment.time}
ğŸ’„ *ServiÃ§o:* ${appointment.service}
ğŸ’° *Valor:* R$ ${appointment.price.toFixed(2)}
${paymentEmoji} *Pagamento:* ${paymentText}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ *EndereÃ§o do SalÃ£o*
${salonSettings.address}
ğŸ“ *Telefone:* ${salonSettings.phone}

âš ï¸ *IMPORTANTE:*
â€¢ Chegue 10 minutos antes
â€¢ Em caso de atraso, ligue para reagendar
â€¢ ${salonSettings.cancellationPolicy}

âœ¨ Obrigada pela preferÃªncia! âœ¨
ğŸ’… Nos vemos em breve!`;

            // Clean phone number (remove all non-digits)
            const cleanPhone = appointment.clientPhone.replace(/\D/g, '');
            
            // Ensure phone has country code
            let phoneWithCountryCode = cleanPhone;
            if (cleanPhone.length === 11 && cleanPhone.startsWith('11')) {
                phoneWithCountryCode = '55' + cleanPhone;
            } else if (cleanPhone.length === 10) {
                phoneWithCountryCode = '5511' + cleanPhone;
            } else if (!cleanPhone.startsWith('55')) {
                phoneWithCountryCode = '55' + cleanPhone;
            }
            
            // Open WhatsApp with the message
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${phoneWithCountryCode}?text=${encodedMessage}`;
            
            // Try to open WhatsApp
            try {
                window.open(whatsappUrl, '_blank');
            } catch (error) {
                console.error('Erro ao abrir WhatsApp:', error);
                // Fallback: copy message to clipboard
                navigator.clipboard.writeText(message).then(() => {
                    alert('ğŸ“‹ Mensagem copiada para a Ã¡rea de transferÃªncia! Cole no WhatsApp do cliente.');
                }).catch(() => {
                    alert('ğŸ“± NÃ£o foi possÃ­vel abrir o WhatsApp automaticamente. Copie a mensagem manualmente:\n\n' + message);
                });
            }
        }

        // Display appointments
        function displayAppointments() {
            const appointmentsList = document.getElementById('appointmentsList');
            
            if (appointments.length === 0) {
                appointmentsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">ğŸ“…</div>
                        <p>Nenhum agendamento encontrado</p>
                    </div>
                `;
                return;
            }
            
            // Sort appointments by date and time
            const sortedAppointments = appointments.sort((a, b) => {
                const dateA = new Date(a.date + ' ' + a.time);
                const dateB = new Date(b.date + ' ' + b.time);
                return dateB - dateA;
            });
            
            appointmentsList.innerHTML = sortedAppointments.map(appointment => {
                const date = new Date(appointment.date);
                const formattedDate = date.toLocaleDateString('pt-BR');
                const paymentClass = appointment.paymentStatus === 'pago' ? 'text-green-600' : 'text-orange-600';
                const paymentIcon = appointment.paymentStatus === 'pago' ? 'âœ…' : 'â³';
                
                return `
                    <div class="bg-white rounded-xl p-4 shadow-custom">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800">${appointment.clientName}</h3>
                                <p class="text-sm text-gray-600">${appointment.clientPhone}</p>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-medium text-gray-700">${formattedDate}</div>
                                <div class="text-sm font-medium text-gray-700">${appointment.time}</div>
                            </div>
                        </div>
                        
                        <div class="border-t pt-3">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-600">ServiÃ§o:</span>
                                <span class="font-medium">${appointment.service}</span>
                            </div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-600">Valor:</span>
                                <span class="font-semibold text-pink-600">R$ ${appointment.price.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Pagamento:</span>
                                <span class="${paymentClass} font-semibold">${paymentIcon} ${appointment.paymentStatus.toUpperCase()}</span>
                            </div>
                        </div>
                        
                        <div class="flex gap-2 mt-4">
                            <button onclick="resendWhatsApp(${appointment.id})" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg text-sm font-medium transition-colors">
                                ğŸ“± WhatsApp
                            </button>
                            <button onclick="addExistingToGoogleCalendar(${appointment.id})" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg text-sm font-medium transition-colors">
                                ğŸ“… Google Agenda
                            </button>
                            <button onclick="deleteAppointment(${appointment.id})" class="bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg text-sm font-medium transition-colors">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Resend WhatsApp message
        function resendWhatsApp(appointmentId) {
            const appointment = appointments.find(a => a.id === appointmentId);
            if (appointment) {
                generateWhatsAppMessage(appointment);
            }
        }

        // Add existing appointment to Google Calendar
        function addExistingToGoogleCalendar(appointmentId) {
            const appointment = appointments.find(a => a.id === appointmentId);
            if (appointment) {
                addToGoogleCalendar(appointment);
            }
        }

        // Delete appointment
        function deleteAppointment(appointmentId) {
            if (confirm('âŒ Tem certeza que deseja excluir este agendamento?')) {
                appointments = appointments.filter(a => a.id !== appointmentId);
                saveData();
                displayAppointments();
            }
        }

        // Show storage information
        function showStorageInfo() {
            try {
                const totalServices = services.length;
                const totalAppointments = appointments.length;
                const lastBackup = localStorage.getItem('salonBackup') ? 
                    JSON.parse(localStorage.getItem('salonBackup')).lastBackup : null;
                
                console.log('ğŸ“± INFORMAÃ‡Ã•ES DE ARMAZENAMENTO:');
                console.log(`ğŸ“‹ ServiÃ§os salvos: ${totalServices}`);
                console.log(`ğŸ“… Agendamentos salvos: ${totalAppointments}`);
                if (lastBackup) {
                    console.log(`ğŸ’¾ Ãšltimo backup: ${new Date(lastBackup).toLocaleString('pt-BR')}`);
                }
                console.log('ğŸ’¡ Todos os dados ficam salvos no seu celular/dispositivo');
            } catch (error) {
                console.error('Erro ao mostrar informaÃ§Ãµes de armazenamento:', error);
            }
        }

        // Export data for backup
        function exportData() {
            try {
                const exportData = {
                    services: services,
                    appointments: appointments,
                    exportDate: new Date().toISOString(),
                    salonName: 'SalÃ£o da minha gatinha'
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `salon-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                alert('âœ… Backup exportado com sucesso! Arquivo salvo na pasta Downloads.');
            } catch (error) {
                console.error('Erro ao exportar dados:', error);
                alert('âŒ Erro ao exportar backup.');
            }
        }

        // Clear all data (with confirmation)
        function clearAllData() {
            if (confirm('âš ï¸ ATENÃ‡ÃƒO: Isso apagarÃ¡ TODOS os dados salvos (serviÃ§os e agendamentos). Tem certeza?')) {
                if (confirm('ğŸš¨ ÃšLTIMA CONFIRMAÃ‡ÃƒO: Todos os dados serÃ£o perdidos permanentemente. Continuar?')) {
                    try {
                        // Clear all localStorage data
                        const keys = Object.keys(localStorage);
                        keys.forEach(key => {
                            if (key.startsWith('salon') || key.startsWith('appointment_')) {
                                localStorage.removeItem(key);
                            }
                        });
                        
                        // Reset to default data
                        services = [
                            { category: 'Unhas', name: 'EsmaltaÃ§Ã£o Simples', description: 'EsmaltaÃ§Ã£o tradicional com cores variadas', price: 25 },
                            { category: 'Unhas', name: 'EsmaltaÃ§Ã£o em Gel', description: 'EsmaltaÃ§Ã£o duradoura com acabamento profissional', price: 40 },
                            { category: 'Cabelos', name: 'Corte Feminino', description: 'Cortes modernos e personalizados', price: 50 },
                            { category: 'Outros', name: 'Sobrancelha', description: 'Design e modelagem de sobrancelhas', price: 30 }
                        ];
                        appointments = [];
                        
                        // Regenerate all sections
                        generateCatalog();
                        generatePricingList();
                        generateServiceSelect();
                        displayAppointments();
                        
                        alert('âœ… Todos os dados foram apagados e o sistema foi resetado.');
                    } catch (error) {
                        console.error('Erro ao limpar dados:', error);
                        alert('âŒ Erro ao limpar dados.');
                    }
                }
            }
        }

        // Update header title
        function updateHeaderTitle() {
            const headerTitle = document.getElementById('headerTitle');
            if (headerTitle) {
                headerTitle.textContent = `ğŸ’… ${salonSettings.name}`;
            }
        }

        // Load salon settings form
        function loadSalonSettingsForm() {
            document.getElementById('salonName').value = salonSettings.name;
            document.getElementById('salonAddress').value = salonSettings.address;
            document.getElementById('salonPhone').value = salonSettings.phone;
            document.getElementById('salonCancellationPolicy').value = salonSettings.cancellationPolicy;
        }

        // Save salon settings
        function saveSalonSettings() {
            const name = document.getElementById('salonName').value.trim();
            const address = document.getElementById('salonAddress').value.trim();
            const phone = document.getElementById('salonPhone').value.trim();
            const cancellationPolicy = document.getElementById('salonCancellationPolicy').value.trim();

            if (!name) {
                alert('âŒ Por favor, informe o nome do salÃ£o');
                return;
            }

            if (!address) {
                alert('âŒ Por favor, informe o endereÃ§o do salÃ£o');
                return;
            }

            if (!phone) {
                alert('âŒ Por favor, informe o telefone do salÃ£o');
                return;
            }

            if (!cancellationPolicy) {
                alert('âŒ Por favor, informe a polÃ­tica de cancelamento');
                return;
            }

            salonSettings.name = name;
            salonSettings.address = address;
            salonSettings.phone = phone;
            salonSettings.cancellationPolicy = cancellationPolicy;

            saveData();
            updateHeaderTitle();

            alert('âœ… ConfiguraÃ§Ãµes salvas com sucesso!\n\nğŸ“± As novas informaÃ§Ãµes aparecerÃ£o nos prÃ³ximos agendamentos e mensagens do WhatsApp.');
        }

        // Reset salon settings to default
        function resetSalonSettings() {
            if (confirm('ğŸ”„ Tem certeza que deseja restaurar as configuraÃ§Ãµes padrÃ£o do salÃ£o?')) {
                salonSettings = {
                    name: 'SalÃ£o da minha gatinha',
                    address: 'Rua das Graviolas, NÂ° 350',
                    phone: '(11) 95246-8795',
                    cancellationPolicy: 'Cancelamentos com menos de 2h nÃ£o terÃ£o reembolso'
                };

                loadSalonSettingsForm();
                saveData();
                updateHeaderTitle();

                alert('âœ… ConfiguraÃ§Ãµes restauradas para o padrÃ£o!');
            }
        }

        // Open WhatsApp
        function openWhatsApp() {
            const message = encodeURIComponent(`OlÃ¡! Gostaria de agendar um horÃ¡rio no ${salonSettings.name}! ğŸ’…âœ¨`);
            window.open(`https://wa.me/?text=${message}`, '_blank');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'977dd63e23fa80fe',t:'MTc1NjY1NzAzNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
